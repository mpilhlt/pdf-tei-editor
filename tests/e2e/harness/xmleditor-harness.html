<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>xmlTagSync Harness</title>
  <style> #editor { height: 300px; } </style>
  <script>
    (async () => {
      const res = await fetch('/importmap.json');
      const mapUrl = res.url; // absolute URL of the importmap file
      const map = await res.json();

      // The importmap uses paths relative to its own location (app/web/).
      // Resolve them to absolute paths so they work from any page URL.
      const resolve = (v) => new URL(v, mapUrl).pathname;
      const rebasedMap = {
        imports: Object.fromEntries(
          Object.entries(map.imports || {}).map(([k, v]) => [k, resolve(v)])
        ),
        scopes: Object.fromEntries(
          Object.entries(map.scopes || {}).map(([scope, entries]) => [
            resolve(scope),
            Object.fromEntries(Object.entries(entries).map(([k, v]) => [k, resolve(v)])),
          ])
        ),
      };

      const imp = document.createElement('script');
      imp.type = 'importmap';
      imp.textContent = JSON.stringify(rebasedMap);
      document.head.appendChild(imp);

      const mod = document.createElement('script');
      mod.type = 'module';
      mod.src = '/tests/e2e/harness/xmleditor-harness.js';
      document.head.appendChild(mod);
    })();
  </script>
</head>
<body><div id="editor"></div></body>
</html>
